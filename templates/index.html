<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>微博超话批量签到 | Web版</title>
    <link rel="stylesheet" href="https://cdn.staticfile.org/tailwindcss/2.2.19/tailwind.min.css">
    <link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.4.0/css/all.min.css">
    <style>
        .log-item {
            transition: all 0.2s ease;
        }
        .log-item:hover {
            background-color: #f3f4f6;
        }
        .btn-hover {
            transition: all 0.3s ease;
        }
        .btn-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- 顶部导航 -->
    <header class="bg-gradient-to-r from-pink-500 to-red-500 text-white shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <h1 class="text-2xl md:text-3xl font-bold flex items-center">
                <i class="fab fa-weibo mr-3"></i>
                微博超话批量签到
            </h1>
            <p class="mt-2 text-pink-100">Web可视化版 | 支持多账户管理</p>
        </div>
    </header>

    <!-- 主内容区 -->
    <main class="container mx-auto px-4 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- 左侧：Cookie管理 -->
            <div class="lg:col-span-1 bg-white rounded-xl shadow-md p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-cookie-bite mr-2 text-pink-500"></i>
                    Cookie管理
                </h2>
                
                <!-- 添加Cookie表单 -->
                <form id="addCookieForm" class="mb-6">
                    <div class="mb-4">
                        <label for="cookieInput" class="block text-sm font-medium text-gray-700 mb-1">
                            微博Cookie
                        </label>
                        <textarea 
                            id="cookieInput" 
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-pink-500 transition-all"
                            rows="4" 
                            placeholder="请粘贴微博Cookie内容..."></textarea>
                    </div>
                    <button 
                        type="submit" 
                        class="w-full bg-pink-500 hover:bg-pink-600 text-white py-2 px-4 rounded-lg btn-hover flex items-center justify-center">
                        <i class="fas fa-plus mr-2"></i> 添加Cookie
                    </button>
                </form>

                <!-- Cookie列表 -->
                <div class="mt-6">
                    <h3 class="text-lg font-medium text-gray-700 mb-3">已添加的账户</h3>
                    <div id="cookieList" class="space-y-3">
                        {% if cookies %}
                            {% for cookie in cookies %}
                                <div class="bg-gray-50 p-3 rounded-lg flex justify-between items-center">
                                    <div class="text-sm text-gray-700">
                                        <span class="font-medium">账户{{ cookie.index }}：</span>
                                        <span>{{ cookie.show }}</span>
                                    </div>
                                    <button 
                                        class="delete-btn text-red-500 hover:text-red-600 btn-hover"
                                        data-index="{{ cookie.index }}">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </div>
                            {% endfor %}
                        {% else %}
                            <div class="text-center text-gray-500 py-4">
                                <i class="fas fa-info-circle mr-1"></i> 暂无添加的Cookie
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- 右侧：签到操作 & 日志 -->
            <div class="lg:col-span-2 bg-white rounded-xl shadow-md p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-sign-in-alt mr-2 text-pink-500"></i>
                    签到操作
                </h2>

                <!-- 签到按钮 -->
                <button 
                    id="runSignBtn" 
                    class="bg-gradient-to-r from-pink-500 to-red-500 hover:from-pink-600 hover:to-red-600 text-white py-3 px-8 rounded-lg btn-hover text-lg font-medium flex items-center">
                    <i class="fas fa-play-circle mr-2"></i> 执行批量签到
                </button>

                <!-- 签到日志 -->
                <div class="mt-8">
                    <h3 class="text-lg font-medium text-gray-700 mb-3 flex items-center">
                        <i class="fas fa-history mr-2 text-pink-500"></i>
                        签到日志
                    </h3>
                    <div id="signLogs" class="bg-gray-50 rounded-lg p-4 h-80 overflow-y-auto space-y-2">
                        <div class="text-gray-500 text-center">
                            点击上方按钮开始签到，日志将显示在这里...
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="mt-12 bg-gray-800 text-white py-6">
        <div class="container mx-auto px-4 text-center">
            <p>微博超话批量签到 Web版 | 基于Python Flask开发</p>
            <p class="text-gray-400 text-sm mt-2">© 2025 仅供学习使用，请勿用于商业用途</p>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="https://cdn.staticfile.org/jquery/3.7.1/jquery.min.js"></script>
    <script>
        $(document).ready(function() {
            // 添加Cookie
            $('#addCookieForm').submit(function(e) {
                e.preventDefault();
                const cookie = $('#cookieInput').val().trim();
                
                $.ajax({
                    url: '/add_cookie',
                    method: 'POST',
                    data: { cookie: cookie },
                    success: function(res) {
                        if (res.status === 'success') {
                            alert(res.msg);
                            location.reload();
                        } else {
                            alert(res.msg);
                        }
                    },
                    error: function() {
                        alert('请求失败，请重试！');
                    }
                });
            });

            // 删除Cookie
            $('.delete-btn').click(function() {
                const index = $(this).data('index');
                if (confirm(`确定要删除账户${index}的Cookie吗？`)) {
                    $.ajax({
                        url: '/delete_cookie',
                        method: 'POST',
                        data: { index: index },
                        success: function(res) {
                            if (res.status === 'success') {
                                alert(res.msg);
                                location.reload();
                            } else {
                                alert(res.msg);
                            }
                        },
                        error: function() {
                            alert('请求失败，请重试！');
                        }
                    });
                }
            });

            // 执行签到
            $('#runSignBtn').click(function() {
                const $btn = $(this);
                $btn.prop('disabled', true).html('<i class="fas fa-spinner fa-spin mr-2"></i> 签到中...');
                $('#signLogs').html('<div class="text-gray-500 text-center">正在执行签到，请稍候...</div>');

                $.ajax({
                    url: '/run_sign',
                    method: 'POST',
                    success: function(res) {
                        $btn.prop('disabled', false).html('<i class="fas fa-play-circle mr-2"></i> 执行批量签到');
                        
                        if (res.status === 'success') {
                            // 显示日志
                            const logs = res.logs;
                            let logHtml = '';
                            logs.forEach(log => {
                                logHtml += `<div class="log-item text-sm py-1">${log}</div>`;
                            });
                            $('#signLogs').html(logHtml);
                            // 滚动到最新日志
                            $('#signLogs').scrollTop($('#signLogs')[0].scrollHeight);
                        } else {
                            $('#signLogs').html(`<div class="text-red-500 text-center">${res.msg}</div>`);
                        }
                    },
                    error: function() {
                        $btn.prop('disabled', false).html('<i class="fas fa-play-circle mr-2"></i> 执行批量签到');
                        $('#signLogs').html('<div class="text-red-500 text-center">请求失败，请重试！</div>');
                    }
                });
            });
        });
    </script>
</body>
</html>